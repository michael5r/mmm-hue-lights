<script>
	Module = {
		register: (name, content) => {
			console.log(name, content);
			mod = content;
			mod.name = name;
		},
	};
	Log = console;
</script>
<script src="../mmm-hue-lights.js"></script>
<script>
	require = () => {
		return {
			default: null,
			create: (content) => {
				console.log("node_helper", content);
				helper = content;
				helper.name = mod.name;
			},
		};
	};
	module = {};
</script>
<script src="../node_helper.js"></script>
<script>
	mod
		.getScripts()
		.forEach((i) => document.write(`<script src="../${i}"><\/script>`));
	mod
		.getStyles()
		.forEach((i) => document.write(`<link rel="stylesheet" href="../${i}">`));
</script>

<div class="mod mmm-hue-lights"></div>

<script>
	mod.updateDom = () => document.querySelector(".mod").append(mod.getDom());
	mod.sendSocketNotification = (notification, payload) => {
		console.log(notification, payload);
		if (notification === "MMM_HUE_LIGHTS_GET") return;
		helper.socketNotificationReceived(notification, payload);
	};
	helper.sendSocketNotification = (notification, payload) => {
		console.log(notification, payload);
		mod.socketNotificationReceived(notification, payload);
	};

	mod.config = mod.defaults;
	mod.config.bridgeIp = "127.0.0.1:8080";
	mod.config.user = "mock-user";
	mod.config.orderByName = true;
	mod.config.displayMode = "groups";

	helper.start();
	mod.start();
	fetch("marks_hue.json")
		.then((response) => response.json())
		.then((data) => {
			mod.lights = data.lights;
			mod.groups = data.groups;
			mod.loaded = true;
			mod.updateDom();
		});
</script>
